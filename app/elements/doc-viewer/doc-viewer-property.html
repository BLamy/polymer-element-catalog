<link rel="import" href="../../bower_components/marked-element/marked-element.html">

<dom-module id="doc-viewer-property">
  <style>
    :host {
      display: block;
      padding: 12px 24px;
    }

    h4 {
      min-width: 180px;
      padding-right: 8px;
      margin: 0;
    }
    h4, #prop-name, #prop-type {
      line-height: 24px;
      font-family: Inconsolata, monospace;
      font-size: 14px;
      font-weight: bold;
    }

    marked-element::shadow p { line-height: 24px; }
    marked-element::shadow p:first-child { margin-top: 0; }
    marked-element::shadow p:last-child { margin-bottom: 0; }
  </style>
  <template>
    <div class="layout horizontal">
      <h4 id="prop-name">[[_name]]</h4>
      <div class="flex layout vertical">
        <div class="layout horizontal" hidden$="[[!_type]]">
          <span id="prop-type" class="flex">[[_type]]</span>
        </div>
        <marked-element markdown="[[prop.desc]]"></marked-element>
      </div>
    </div>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'doc-viewer-property',
    properties: {
      dashed: {type: Boolean, value: false},
      prop: Object,
      private: {type: Boolean, value: false, reflectToAttribute: true, computed: 'computePrivate(prop)'},
      _name: {type: String, computed: 'computeName(prop, dashed)'},
      _type: {type: String, computed: 'computeType(prop)' }
    },
    observers: {
      'showPrivate prop': 'showPrivateChanged'
    },
    computeName: function(prop, dashed) {
      var out;
      if (dashed) {
        console.log('dashed', prop.name);
        out = Polymer.CaseMap.camelToDashCase(prop.name);
      } else {
        console.log('non-dashed', prop.name);
        out = prop.name;
        if (prop.type === 'Function') {
          var paramNames = (prop.params || []).map(function(p) { return p.name; });
          out += "(" + paramNames.join(',') + ")";
        }
      }
      return out;
    },
    computeType: function(prop) {
      if (prop.type === 'Function') {
        if (prop.return) {
          return "<" + prop.return.type + ">";
        } else {
          return null;
        }
      } else {
        return prop.type;
      }
    },
    computePrivate: function(prop) {
      return prop.private;
    }
  });
</script>