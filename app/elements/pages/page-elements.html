<link rel="import" href="../tag-link/tag-link.html">

<dom-module id="page-elements">
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
    }

    td, th {
      padding: 8px;
      border-bottom: 1px solid #eee;
    }

    a {
      font-weight: bold;
      color: black;
      text-decoration: none;
    }

    [size=xs] .description {
      display: none;
    }
  </style>
  <template>
    <catalog-data elements="{{rawElements}}"></catalog-data>

    <responsive-element>
      <table>
        <thead>
          <tr>
            <th class="name">Element Name</th>
            <th class="description">Description</th>
            <th class="package">Package</th>
            <th class="tags">Tags</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <template is="x-repeat" items="{{elements}}" filter="filter" observe="tag package">
            <tr>
              <td class="name"><a href="{{item.elementLink}}">{{item.name}}</a></td>
              <td class="description">{{item.description}}</td>
              <td class="package"><a href="{{item.packageLink}}">{{item.package}}</a></td>
              <td class="tags">
                <template is="x-repeat" items="{{item.tags}}">
                  <tag-link name="[[item]]"></tag-link>
                </template>
              </td>
            </tr>
          </template>
        </tbody>
      </table>
    </responsive-element>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'page-elements',
    properties: {
      tag: String,
      package: String,
      rawElements: Object,
      elements: {
        type: Array,
        computed: 'populateElements(rawElements)'
      }
    },
    populateElements: function(rawElements) {
      var out = [];
      for (var el in rawElements) {
        rawElements[el].elementLink = "/#/elements/" + rawElements[el].name;
        rawElements[el].packageLink = "/#/elements?package=" + rawElements[el].package;
        out.push(rawElements[el]);
      }
      return out;
    },
    filter: function(element) {
      if (this.tag && this.tag.length && element.tags.indexOf(this.tag) < 0) return false;
      if (this.package && this.package.length && element.package !== this.package) return false;
      return true;
    }
  });
</script>