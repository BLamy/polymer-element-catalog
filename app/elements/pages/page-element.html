<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">

<link rel="import" href="../catalog-element/catalog-element.html">
<link rel="import" href="../catalog-package/catalog-package.html">
<link rel="import" href="../doc-viewer/doc-viewer.html">
<link rel="import" href="../package-symbol/package-symbol.html">
<link rel="import" href="../responsive-element/responsive-element.html">
<link rel="import" href="../theme-color/theme-color.html">

<dom-module id="page-element">
  <link rel="import" type="css" href="page-element.css">
  <template>
    <catalog-element name="[[element]]" data="{{metadata}}"></catalog-element>
    <catalog-package name="[[metadata.package]]" data="{{package}}"></catalog-package>

    <theme-color color="[[package.color]]">
      <responsive-element class="horizontal layout fit">
        <app-sidebar>
          <paper-toolbar class="horizontal layout center">
            <app-logo class="flex"></app-logo>
            <app-bar class="horizontal layout center end-justified">
              <iron-icon icon="filter-list"></iron-icon>
            </app-bar>
          </paper-toolbar>
          <div class="content">
            <div id="element-info">
              <div id="element-header">
                <package-symbol package="[[package]]" class="large" on-click="navToPackage"></package-symbol>
                <h2 id="element-title">[[element]]</h2>
                <div id="element-desc">
                  <p>[[metadata.description]]</p>
                </div>
              </div>

              <div id="element-tags" class="section">
                <h5>Tags</h5>
                <p>
                  <template is="x-repeat" items="[[metadata.tags]]">
                    <tag-link name="[[item]]"></tag-link><span>,</span>
                  </template>
                </p>
              </div>
            </div>
          </div>
        </app-sidebar>
        <paper-header-panel class="flex vertical layout">
          <paper-toolbar class="paper-header flex-none">
            <span class="flex">[[element]]</span>
            <iron-selector attr-for-selected="view" selected="{{view}}" id="links">
              <a view="docs"><iron-icon icon="description"></iron-icon> Docs</a>
              <a view="demo"><iron-icon icon="visibility"></iron-icon> Demo</a>
            </iron-selector>
            <iron-icon icon="fullscreen"></iron-icon>
          </paper-toolbar>
          <iron-selector id="content" attr-for-selected="id" selected="{{view}}" class="content fit">
            <div id="demo" class="fit">
              <iframe src="[[demoSrc(element)]]" id="demo-frame"></iframe>
            </div>
            <div id="docs" class="vertical layout">
              <doc-viewer element="[[element]]"></doc-viewer>
            </div>
          </iron-selector>
        </paper-header-panel>
      </responsive-element>
    </theme-color>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'page-element',
    enableCustomStyleProperties: true,
    properties: {
      element: {type: String, notify: true},
      view: {type: String, notify: true},
      docs: Object,
      metadata: Object,
      package: Object,
      router: Object
    },
    observers: [
      'updateURL(view)',
      'updateMeta(element)',
      'showElement(element)',
      'analyze(importPath)'
    ],
    attached: function() {
      var links = this.$.links;
      var tabs = links.querySelectorAll('paper-item');
      links.addEventListener('iron-select', function(event) {
        var tabColor = links.style.color;
        for (var i = 0; i < tabs.length; i++) {
          tabs[i].style.borderColor = 'transparent';
        }
        event.detail.item.style.borderColor = tabColor;
      });
      this.updateMeta();
    },
    analyze: function() {
      this.$.analyzer.analyze();
    },
    updateURL: function() {
      if (this.router) this.router.go("/elements/" + this.element + "/" + this.view, {replace: true});
    },
    updateMeta: function() {
      this.fire('page-meta', {title: this.element});
    },
    showElement: function() {
      this.$['element-info'].classList.remove('active');
      setTimeout(function() { this.$['element-info'].classList.add('active'); }.bind(this), 25);
    },
    navToPackage: function() {
      this.router.go("/browse?package=" + this.package.name);
    },
    demoSrc: function(element) {
      return "/bower_components/" + element + "/demo/index.html";
    }
  });
</script>