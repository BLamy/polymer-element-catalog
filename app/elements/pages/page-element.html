<link rel="import" href="../../bower_components/core-selector/core-selector.html">
<link rel="import" href="../../bower_components/core-icons/core-icons.html">
<link rel="import" href="../../bower_components/iron-doc-viewer/iron-doc-viewer.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">

<link rel="import" href="../theme-color/theme-color.html">
<link rel="import" href="../responsive-element/responsive-element.html">
<link rel="import" href="../catalog-element/catalog-element.html">
<link rel="import" href="../catalog-package/catalog-package.html">
<link rel="import" href="../doc-loader/doc-loader.html">
<link rel="import" href="../doc-viewer/doc-viewer.html">

<dom-module id="page-element">
  <style>
    responsive-element[size=xs].layout {
      -ms-flex-direction: column;
      -webkit-flex-direction: column;
      flex-direction: column;
    }

    [size=xs] app-sidebar {
      min-width: 100%;
      height: auto;
    }

    [size=xs] app-sidebar core-toolbar /deep/ #topBar {
      padding: 0 16px;
    }

    #docs {
      background: white;
      max-width: 44em;
      margin: 0 auto;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
    }

    #docs h3 {
      padding: 20px 30px;
      margin: 0;
      border-bottom: 1px solid #eee;
    }

    #docs-content {
      padding: 30px;
    }

    #element-header {
      padding: 20px 16px;
      background: #ccc;
      box-shadow: inset 0px 5px 6px -3px rgba(0,0,0,0.4);
      overflow: hidden;
    }

    #element-header core-icon {
      cursor: pointer;
    }

    .section {
      padding: 0 16px;
    }

    [size=xs] .section {
      display: none;
    }

    #package {
      font-size: 1.1em;
      margin: 8px;
      margin: 12px 0;
    }

    #package-symbol {
      display: inline-block;
      padding: 6px;
      margin-right: 10px;
      font-size: 22px;
      font-weight: 900;
      line-height: 18px;
    }

    #package-title {
      font-weight: 600;
    }

    [size=xs] #links {
      display: -ms-flexbox;
      display: -webkit-flex;
      display: flex;
      -ms-flex-direction: row;
      -webkit-flex-direction: row;
      flex-direction: row;
    }

    paper-item {
      cursor: pointer;
    }

    [size=xs] paper-item {
      -ms-flex: 1;
      -webkit-flex: 1;
      flex: 1;
      -ms-flex-pack: center;
      -webkit-justify-content: center;
      justify-content: center;
      font-weight: 600;
      text-transform: uppercase;
      border-bottom: 2px solid transparent;
      opacity: 0.6;
    }

    #links .core-selected {
      background: #eee;
    }

    [size=xs] #links .core-selected {
      background: transparent;
      border-bottom: 2px solid #fff;
      opacity: 1;
    }

    #content {
      background: #eee;
      padding: 30px;
      overflow: auto;
    }

    #content > div {
      display: none;
    }

    #content > .core-selected {
      display: block;
    }

    [size=xs] #content, [size=s] #content {
      padding: 0;
    }
  </style>
  <template>
    <catalog-element name="[[element]]" data="{{metadata}}"></catalog-element>
    <catalog-package name="[[metadata.package]]" data="{{package}}"></catalog-package>

    <doc-loader src="[[importPath]]" data="{{docs}}"></doc-loader>
    <theme-color color="[[package.color]]">
      <responsive-element class="horizontal layout fit">
        <app-sidebar>
          <core-toolbar class="horizontal layout center">
            <div class="logo flex">
              <a href="/" is="pushstate-anchor" class="horizontal layout center">
                <img src="/images/polymer.svg" width="36">
                <h1 class="flex">Catalog</h1>
              </a>
            </div>
            <app-bar class="horizontal layout center end-justified">
              <core-icon icon="more-vert"></core-icon>
            </app-bar>
          </core-toolbar>
          <div class="content">
            <div id="element-info">
              <div id="element-header" class="horizontal layout center" themed>
                <core-icon on-click="navToPackage" icon="chevron-left"></core-icon>
                <span id="package-symbol" on-click="navToPackage">[[package.symbol]]</span>
                <span id="package-title">[[element]]</span>
              </div>

              <div id="element-desc" class="section">
                <p>[[metadata.description]]</p>
              </div>

              <core-selector attr-for-selected="view" selected="{{view}}" id="links" themed>
                <paper-item view="docs" themed-border-reverse>Documentation</paper-item>
                <paper-item view="demo">Demo</paper-item>
              </core-selector>

              <div id="element-tags" class="section">
                <h4>Tags</h4>
                <div>
                  <template is="x-repeat" items="[[metadata.tags]]">
                    <tag-link name="[[item]]"></tag-link>
                  </template>
                </div>
              </div>
            </div>
          </div>
        </app-sidebar>
        <core-selector id="content" attr-for-selected="id" selected="{{view}}" class="flex horizontal layout center center-justified">
          <div id="demo"><h1>Demo Content</h1></div>
          <div id="docs" class="vertical layout self-start">
            <h3 id="doc-heading">[[element]]</h3>
            <div id="docs-content" class="flex">
              <doc-viewer element="[[element]]" data="[[docs]]"></doc-viewer>
            </div>
          </div>
        </core-selector>
      </responsive-element>
    </theme-color>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'page-element',
    properties: {
      element: {type: String, notify: true},
      view: {type: String, notify: true},
      importPath: {type: String, computed: 'importPathFor(element)'},
      docs: Object,
      metadata: Object,
      package: Object,
      router: Object
    },
    observers: {
      view: 'updateURL',
      element: 'updateMeta'
    },
    attached: function() {
      var links = this.$.links;
      var tabs = links.querySelectorAll('paper-item');
      links.addEventListener('core-select', function(event) {
        var tabColor = links.style.color;
        for (var i = 0; i < tabs.length; i++) {
          tabs[i].style.borderColor = 'transparent';
        }
        event.detail.item.style.borderColor = tabColor;
      });
      this.updateMeta();
    },
    importPathFor: function(element) {
      return ["/bower_components", element, element + ".html"].join("/");
    },
    updateURL: function() {
      if (this.router) this.router.go("/elements/" + this.element + "/" + this.view, {replace: true});
    },
    updateMeta: function() {
      this.fire('page-meta', {title: this.element});
    },
    navToPackage: function() {
      this.router.go("/browse?package=" + this.package.name);
    }
  });
</script>