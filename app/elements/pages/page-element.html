<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/iron-component-page/iron-component-page.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">

<link rel="import" href="../catalog-element/catalog-element.html">
<link rel="import" href="../catalog-package/catalog-package.html">
<link rel="import" href="../package-symbol/package-symbol.html">
<link rel="import" href="../responsive-element/responsive-element.html">
<link rel="import" href="../theme-color/theme-color.html">
<link rel="import" href="../cart-icon/cart-icon.html">

<dom-module id="page-element">
  <link rel="import" type="css" href="page-element.css">
  <template>
    <catalog-element name="[[element]]" data="{{metadata}}"></catalog-element>
    <catalog-package name="[[metadata.package]]" data="{{package}}"></catalog-package>

    <theme-color color="[[package.color]]">
      <paper-drawer-panel drawer-width="272px" disable-edge-swipe>
        <app-sidebar drawer>
          <paper-toolbar>
            <app-logo class="flex"></app-logo>
            <app-bar class="horizontal layout center end-justified">
              <iron-icon icon="filter-list"></iron-icon>
            </app-bar>
          </paper-toolbar>
          <div class="content">
            <div class="horizontal layout center" id="package-heading">
              <iron-icon icon="chevron-left"></iron-icon>
              <package-symbol package="[[package]]" on-tap="navToPackage"></package-symbol>
              <span class="name flex">[[package.title]]</span>
            </div>
            <div id="element-info">
              <div id="element-header">
                <span class="version">[[metadata.version]]</span>
                <h2 id="element-title">[[element]]</h2>
                <div id="element-desc">
                  <p>[[metadata.description]]</p>
                </div>
              </div>

              <iron-selector id="nav" class="nav" attr-for-selected="name" selected="{{view}}">
                <paper-item name="docs"><iron-icon icon="description"></iron-icon> <span>Docs</span></paper-item>
                <paper-item name="demo"><iron-icon icon="visibility"></iron-icon> <span>Demo</span></paper-item>
              </iron-selector>

              <section hidden$="[[_oneOrFewer(docElements)]]">
                <h4>Bundled Elements</h4>

                <iron-selector id="elnav" class="nav" attr-for-selected="name" selected="{{active}}">
                  <template is="dom-repeat" items="[[docElements]]">
                    <paper-item name="[[item.is]]">[[item.is]]</paper-item>
                  </template>
                </iron-selector>
              </section>

              <section hidden$="[[_oneOrFewer(docBehaviors)]]">
                <h4>Bundled Behaviors</h4>

                <iron-selector id="elnav" class="nav" attr-for-selected="name" selected="{{active}}">
                  <template is="dom-repeat" items="[[docBehaviors]]">
                    <paper-item name="[[item.is]]">[[item.is]]</paper-item>
                  </template>
                </iron-selector>
              </section>
            </div>
          </div>
        </app-sidebar>
        <section main class="fit">
          <iron-component-page version="[[metadata.version]]" doc-src="[[docSrc(element)]]" base="[[baseURI(element)]]" _catalog view="{{view}}" doc-elements="{{docElements}}" doc-behaviors="{{docBehaviors}}" active="{{active}}"></iron-component-page>
          <cart-icon></cart-icon>
        </section>
      </paper-drawer-panel>
    </theme-color>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'page-element',
    enableCustomStyleProperties: true,
    properties: {
      element: {type: String, notify: true},
      view: {type: String, notify: true},
      docElements: Array,
      docBehaviors: Array,
      active: String,
      docs: Object,
      metadata: Object,
      package: Object,
      router: Object
    },
    observers: [
      'updateURL(view)',
      'updateMeta(element)',
      'showElement(element)',
      'analyze(importPath)'
    ],
    attached: function() {
      this.updateMeta();
    },
    analyze: function() {
      this.$.analyzer.analyze();
    },
    updateURL: function() {
      if (this.router) this.router.go("/elements/" + this.element + "/" + this.view, {replace: true});
    },
    updateMeta: function() {
      this.fire('page-meta', {title: this.element});
    },
    showElement: function() {
      this.$['element-info'].classList.remove('active');
      setTimeout(function() { this.$['element-info'].classList.add('active'); }.bind(this), 25);
    },
    navToPackage: function() {
      this.router.go("/browse?package=" + this.package.name);
    },
    docSrc: function(element) {
      return "/data/docs/" + element + ".json";
    },
    baseURI: function(element) {
      return window.location.origin + "/bower_components/" + element + "/" + element + ".html";
    },
    _oneOrFewer: function(arr) {
      return !arr || arr.length <= 1;
    }
  });
</script>