<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">

<link rel="import" href="../theme-color/theme-color.html">
<link rel="import" href="../responsive-element/responsive-element.html">
<link rel="import" href="../catalog-element/catalog-element.html">
<link rel="import" href="../catalog-package/catalog-package.html">
<link rel="import" href="../doc-viewer/doc-viewer.html">

<dom-module id="page-element">
  <style>
    responsive-element[size=xs].layout {
      -ms-flex-direction: column;
      -webkit-flex-direction: column;
      flex-direction: column;
    }

    [size=xs] app-sidebar {
      min-width: 100%;
      height: auto;
    }

    [size=xs] app-sidebar paper-toolbar /deep/ #topBar {
      padding: 0 16px;
    }

    #docs {
      max-width: 52em;
      margin: 0 auto;
    }

    #element-header {
      padding: 20px 16px;
      background: #ccc;
      box-shadow: inset 0px 5px 6px -3px rgba(0,0,0,0.4);
      overflow: hidden;
    }

    #element-header iron-icon {
      cursor: pointer;
    }

    .section {
      padding: 0 16px;
    }

    [size=xs] .section {
      display: none;
    }

    #package {
      font-size: 1.1em;
      margin: 8px;
      margin: 12px 0;
    }

    #package-symbol {
      display: inline-block;
      padding: 6px;
      margin-right: 10px;
      font-size: 22px;
      font-weight: 900;
      line-height: 18px;
    }

    #package-title {
      font-weight: 600;
    }

    paper-item {
      cursor: pointer;
    }

    #links a { margin: 0 8px; cursor: pointer; }
    #links a, #links core-icon {
      font-weight: normal;
      color: #777;
    }

    #links .iron-selected {
      color: #333;
    }

    #content {
      background: #eee;
      padding: 30px;
      overflow: auto;
    }

    #content > div {
      display: none;
    }

    #content > .iron-selected {
      display: block;
    }

    #demo {
      overflow: hidden;
    }
    #demo-frame {
      border: 0;
      background: transparent;
      width: 100%;
      height: 100%;
    }

    [size=xs] #content, [size=s] #content {
      padding: 0;
    }
  </style>
  <template>
    <catalog-element name="[[element]]" data="{{metadata}}"></catalog-element>
    <catalog-package name="[[metadata.package]]" data="{{package}}"></catalog-package>

    <theme-color color="[[package.color]]">
      <responsive-element class="horizontal layout fit">
        <app-sidebar>
          <paper-toolbar class="horizontal layout center">
            <app-logo class="flex"></app-logo>
            <app-bar class="horizontal layout center end-justified">
              <iron-icon icon="more-vert"></iron-icon>
            </app-bar>
          </paper-toolbar>
          <div class="content">
            <div id="element-info">
              <div id="element-header" class="horizontal layout center" themed>
                <iron-icon on-click="navToPackage" icon="chevron-left"></iron-icon>
                <span id="package-symbol" on-click="navToPackage">[[package.symbol]]</span>
                <span id="package-title">[[element]]</span>
              </div>

              <div id="element-desc" class="section">
                <p>[[metadata.description]]</p>
              </div>

              <div id="element-tags" class="section">
                <h4>Tags</h4>
                <div>
                  <template is="x-repeat" items="[[metadata.tags]]">
                    <tag-link name="[[item]]"></tag-link>
                  </template>
                </div>
              </div>
            </div>
          </div>
        </app-sidebar>
        <paper-header-panel class="flex vertical layout">
          <paper-toolbar class="paper-header flex-none">
            <span class="flex">[[element]]</span>
            <iron-selector attr-for-selected="view" selected="{{view}}" id="links">
              <a view="docs"><iron-icon icon="description"></iron-icon> Docs</a>
              <a view="demo"><iron-icon icon="visibility"></iron-icon> Demo</a>
            </iron-selector>
            <iron-icon icon="fullscreen"></iron-icon>
          </paper-toolbar>
          <iron-selector id="content" attr-for-selected="id" selected="{{view}}" class="content fit">
            <div id="demo" class="fit">
              <iframe src="[[demoSrc(element)]]" id="demo-frame"></iframe>
            </div>
            <div id="docs" class="vertical layout">
              <doc-viewer element="[[element]]"></doc-viewer>
            </div>
          </iron-selector>
        </paper-header-panel>
      </responsive-element>
    </theme-color>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'page-element',
    properties: {
      element: {type: String, notify: true},
      view: {type: String, notify: true},
      docs: Object,
      metadata: Object,
      package: Object,
      router: Object
    },
    observers: [
      'updateURL(view)',
      'updateMeta(element)',
      'analyze(importPath)'
    ],
    attached: function() {
      var links = this.$.links;
      var tabs = links.querySelectorAll('paper-item');
      links.addEventListener('iron-select', function(event) {
        var tabColor = links.style.color;
        for (var i = 0; i < tabs.length; i++) {
          tabs[i].style.borderColor = 'transparent';
        }
        event.detail.item.style.borderColor = tabColor;
      });
      this.updateMeta();
    },
    analyze: function() {
      this.$.analyzer.analyze();
    },
    updateURL: function() {
      if (this.router) this.router.go("/elements/" + this.element + "/" + this.view, {replace: true});
    },
    updateMeta: function() {
      this.fire('page-meta', {title: this.element});
    },
    navToPackage: function() {
      this.router.go("/browse?package=" + this.package.name);
    },
    demoSrc: function(element) {
      return "/bower_components/" + element + "/demo/index.html";
    }
  });
</script>